<!DOCTYPE html>
<html>

<head>
  <title>Social Curiosity</title>
  <script src="https://unpkg.com/jspsych@7.3.1"></script>
  <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@1.1.2"></script>
  <script src="https://unpkg.com/@jspsych/plugin-image-keyboard-response@1.1.2"></script>
  <script src="https://unpkg.com/@jspsych/plugin-preload@1.1.2"></script>
  <script src="create-stimulus.js"></script>
  <link href="https://unpkg.com/jspsych@7.3.1/css/jspsych.css" rel="stylesheet" type="text/css" />
</head>
<style>
  body {
    background-color: #444;
    color: white;
  }

  .row {
    display: flex;
  }

  .column {
    flex: 33.33%;
    padding: 5px;
  }
</style>

<body></body>
<script>
  /* initialize jsPsych */
  var jsPsych = initJsPsych();

  /* initialize timeline */
  var timeline = [];

  /* initialize variables */
  var choice; // participant's choice
  var shuffled_set = chunk(shuffle(stimuli_set), 2); // generate randomized image pairs
  var blurriness = chunk(randomBlur(5, 50), 2); // generate randomized levels of blurriness from 5 to 50

  /* preload images */
  var preload = {
    type: jsPsychPreload,
    images: practice_img.concat(img_set)
  };
  timeline.push(preload);

  /* welcome trial */
  var welcome = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `<p>Welcome to the experiment</p><br><p>Press any key to begin.</p>`
  }

  /* instruction trials */
  var instruction_1 = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `
        <p>In each trial, you will see two different images sourced from a popular social platform.</p>
        <p>Each image will have an upvote count above it.</p>
        <p>An upvote is a like given by users of the platform and helps promote quality content and discussion on the platform.</p>
        <p>A higher upvote count means a high percentage of users have liked the post and the post will appear at the top of the platform’s algorithm.</p>
        <br>
        <p>Press any key to continue.</p>
      `,
  };
  
  var instruction_2 = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `
        <p>At the start of every trial, both images will be blurred.</p>
        <p>You will get 10 seconds to choose which image you would like to reveal.</p>
        <p>The image you select will unblur itself, and the other one will stay the same.</p>
        <br>
        <p>Press any key to continue.</p>
      `,
  };
  
var instruction_3 = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `
        <p>We will now go through 2 practice trials.</p>
        <p>Press “←” on your keyboard to select the left image or “→” to select the right image.</p>
        <br>
        <p>On the next slide, you will see the images. Press any key to continue.</p>
      `,
  };
  
  var instruction_proc = {
    timeline: [instruction_1, instruction_2, instruction_3]
  }
  
  /** Reusable Trials **/
  /* choose trial*/
  var choose = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: function () {
      var html =
        `<div class="row">
            <div class="column">
              <p>number of upvotes: ${jsPsych.timelineVariable('n_of_upvotesL')}</p>
              <br>
              <img src= ${jsPsych.timelineVariable('imgL')} style="width:60%; filter: blur(${jsPsych.timelineVariable('blur_levelL') + "px"})">
            </div>
            <div class="column">
              <p>number of upvotes: ${jsPsych.timelineVariable('n_of_upvotesR')}</p>
              <br>
              <img src= ${jsPsych.timelineVariable('imgR')} style="width:60%; filter: blur(${jsPsych.timelineVariable('blur_levelR') + "px"})">
            </div>
          </div>
          `;
      return html;
    },
    choices: ['ArrowLeft', 'ArrowRight'],
    prompt: `<p>Which one do you want to reveal?</p>`,
    data: {
      task: "choice_response",
    },
    on_finish: function (data) {
      choice = data.response;
    }
  }

  /* reveal trial */
  var reveal = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: function () {
      if (choice == 'arrowleft') {
        var html =
          `<div class="row">
            <div class="column">
              <p>number of upvotes: ${jsPsych.timelineVariable('n_of_upvotesL')}</p>
              <br>
              <img src= ${jsPsych.timelineVariable('imgL')} style="width:60%">
            </div>
            <div class="column">
              <p>number of upvotes: ${jsPsych.timelineVariable('n_of_upvotesR')}</p>
              <br>
              <img src= ${jsPsych.timelineVariable('imgR')} style="width:60%; filter: blur(${jsPsych.timelineVariable('blur_levelR') + "px"})">
            </div>
          </div>
          <p>You chose the left image</p>
          <p>Press any key to continue</p>
          `;
      }
      else if (choice == 'arrowright') {
        var html =
          `<div class="row">
            <div class="column">
              <p>number of upvotes: ${jsPsych.timelineVariable('n_of_upvotesL')}</p>
              <br>
              <img src= ${jsPsych.timelineVariable('imgL')} style="width:50%; filter: blur(${jsPsych.timelineVariable('blur_levelL') + "px"})">
            </div>
            <div class="column">
              <p>number of upvotes: ${jsPsych.timelineVariable('n_of_upvotesR')}</p>
              <br>
              <img src= ${jsPsych.timelineVariable('imgR')} style="width:50%">
            </div>
          </div>
          <p>You chose the right image</p>
          <p>Press any key to continue</p>
          `;
      }
      return html;
    },
  }


  /** Practice Trials **/
  /* practice stimulus variable */
  var practice_stimuli = [
    {
      imgL: "imgs/img-1.png", n_of_upvotesL: 1731, blur_levelL: 10,
      imgR: "imgs/img-2.png", n_of_upvotesR: 2579, blur_levelR: 30
    },
  ];

  /* trial practice end */
  var practice_end = {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `
        <p>You have completed the tutorial!</p>
        <p>The experiment will begin starting from the next slide.</p>
        <br>
        <p>Press any key to continue when you are ready.</p>
      `,
  }

  /* practice procedure */
  var practice_procedure = {
    timeline: [choose, reveal, practice_end],
    timeline_variables: practice_stimuli
  }

  /** Test Trials **/
  /* test stimulus variable */
  var test_stimuli = [];
  for (let i = 0; i < shuffled_set.length; i++) {
    test_stimuli.push(
      {
        idL: shuffled_set[i][0].id, imgL: shuffled_set[i][0].file, n_of_upvotesL: shuffled_set[i][0].upvote, blur_levelL: blurriness[i][0],
        idR: shuffled_set[i][1].id, imgR: shuffled_set[i][1].file, n_of_upvotesR: shuffled_set[i][1].upvote, blur_levelR: blurriness[i][1]
      }
    )
  };

  /* test procedure */
  var test_procedure = {
    timeline: [choose, reveal],
    timeline_variables: test_stimuli
  }

  /* debrief block */
  var debrief_block =
  {
    type: jsPsychHtmlKeyboardResponse,
    stimulus: `
        <p>Thank you for participating!</p>`,
    choices: "NO_KEYS"
  };

  /* run the experiment */
  timeline.push(welcome);
  timeline.push(instruction_proc);
  timeline.push(practice_procedure);
  timeline.push(test_procedure);
  timeline.push(debrief_block);
  jsPsych.run(timeline);

</script>

</html>
